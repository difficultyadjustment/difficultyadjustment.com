<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚Çø Mining Calculator ‚Äî Difficulty Adjustment</title>
  <meta name="description" content="Bitcoin mining profitability calculator. Input your hashrate and electricity cost to estimate daily, monthly and yearly earnings.">
  <meta name="theme-color" content="#f7931a">
  <link rel="icon" href="/icon.svg">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icon.svg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="shared.css">
  <style>
    .calc-layout {
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 32px;
      margin-bottom: 40px;
    }

    /* Input Panel */
    .calc-inputs {
      position: sticky;
      top: 24px;
      align-self: start;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .input-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .input-row input, .input-row select {
      flex: 1;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 12px 14px;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      transition: border-color 0.2s;
    }

    .input-row input:focus, .input-row select:focus { border-color: var(--accent); }

    .input-unit {
      font-size: 13px;
      color: var(--text-muted);
      white-space: nowrap;
      min-width: 50px;
    }

    .preset-buttons {
      display: flex;
      gap: 6px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .preset-btn {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preset-btn:hover { border-color: var(--accent); color: var(--accent); }

    .calc-btn {
      width: 100%;
      padding: 14px;
      background: var(--btc-gradient);
      border: none;
      border-radius: var(--radius-sm);
      color: #000;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: opacity 0.2s;
      margin-top: 8px;
    }

    .calc-btn:hover { opacity: 0.9; }

    .live-data {
      margin-top: 20px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }

    .live-data-title {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .live-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 13px;
    }

    .live-row .live-label { color: var(--text-secondary); }
    .live-row .live-val {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
    }

    /* Results Panel */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }

    .result-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      text-align: center;
    }

    .result-card.hero {
      border-color: rgba(247, 147, 26, 0.3);
      background: linear-gradient(135deg, rgba(247, 147, 26, 0.05) 0%, var(--bg-card) 60%);
    }

    .result-card .period {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .result-card .btc-amount {
      font-size: 28px;
      font-weight: 800;
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .result-card .fiat-amount {
      font-size: 18px;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 8px;
    }

    .result-card .costs {
      font-size: 12px;
      color: var(--text-muted);
    }

    .result-card .profit {
      font-size: 16px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
    }

    /* Scenarios */
    .scenarios {
      margin-top: 24px;
    }

    .scenario-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .scenario-table th {
      text-align: left;
      padding: 14px 16px;
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 2px solid var(--border);
      background: var(--bg-secondary);
    }

    .scenario-table td {
      padding: 12px 16px;
      font-size: 13px;
      border-bottom: 1px solid var(--border);
      font-family: 'JetBrains Mono', monospace;
    }

    .scenario-table tr:hover { background: var(--bg-card-hover); }
    .scenario-table .positive { color: var(--green); }
    .scenario-table .negative { color: var(--red); }

    .disclaimer {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 24px;
      font-style: italic;
      text-align: center;
    }

    @media (max-width: 1024px) {
      .calc-layout { grid-template-columns: 1fr; }
      .calc-inputs { position: static; }
      .results-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="header-left">
        <a href="/">
          <span class="logo">‚Çø</span>
          <h1>Difficulty<span class="accent">Adjustment</span></h1>
        </a>
      </div>
      <nav class="site-nav">
        <a href="/" class="nav-link">Dashboard</a>
        <a href="/history" class="nav-link">History</a>
        <a href="/learn" class="nav-link">Learn</a>
        <div class="nav-dropdown">
          <button class="nav-link nav-dropdown-btn" onclick="toggleMobileToolsMenu(event)">Tools ‚ñæ</button>
          <div class="nav-dropdown-menu">
            <div class="nav-dropdown-menu-inner">
              <a href="/calculator">‚õèÔ∏è Mining Calculator</a>
              <a href="/dca">üìä DCA Calculator</a>
              <a href="/hodl">üíé HODL Calculator</a>
              <a href="/converter">üîÑ Sats Converter</a>
              <a href="/attack">üõ°Ô∏è 51% Attack Cost</a>
              <a href="/inflation">üìâ Bitcoin vs Inflation</a>
            </div>
          </div>
        </div>
      </nav>
      <div class="header-right"></div>
    </header>

    <div class="page-hero">
      <h2>Mining <span class="accent">Profitability</span> Calculator</h2>
      <p class="subtitle">Estimate your Bitcoin mining earnings based on current network conditions. See how the next difficulty adjustment impacts your bottom line.</p>
    </div>

    <div class="calc-layout">
      <!-- Inputs -->
      <div class="calc-inputs">
        <div class="card">
          <div class="card-header">
            <h3>‚õèÔ∏è Your Mining Setup</h3>
          </div>

          <div class="input-group">
            <label>Hashrate</label>
            <div class="input-row">
              <input type="number" id="hashrate" value="100" min="0" step="1">
              <select id="hashUnit">
                <option value="1e12">TH/s</option>
                <option value="1e15">PH/s</option>
                <option value="1e18">EH/s</option>
              </select>
            </div>
            <div class="preset-buttons">
              <button class="preset-btn" onclick="setPreset(14, 1e12, 3010, 'Antminer S19')">S19 (14 TH)</button>
              <button class="preset-btn" onclick="setPreset(110, 1e12, 3250, 'Antminer S19 XP')">S19 XP (110 TH)</button>
              <button class="preset-btn" onclick="setPreset(198, 1e12, 3450, 'Antminer S21')">S21 (198 TH)</button>
              <button class="preset-btn" onclick="setPreset(335, 1e12, 5000, 'Antminer S21 XP')">S21 XP (335 TH)</button>
            </div>
          </div>

          <div class="input-group">
            <label>Power Consumption</label>
            <div class="input-row">
              <input type="number" id="power" value="3250" min="0" step="10">
              <span class="input-unit">Watts</span>
            </div>
          </div>

          <div class="input-group">
            <label>Electricity Cost</label>
            <div class="input-row">
              <input type="number" id="elecCost" value="0.08" min="0" step="0.01">
              <span class="input-unit">$/kWh</span>
            </div>
            <div class="preset-buttons">
              <button class="preset-btn" onclick="document.getElementById('elecCost').value='0.04';calculate()">$0.04</button>
              <button class="preset-btn" onclick="document.getElementById('elecCost').value='0.06';calculate()">$0.06</button>
              <button class="preset-btn" onclick="document.getElementById('elecCost').value='0.08';calculate()">$0.08</button>
              <button class="preset-btn" onclick="document.getElementById('elecCost').value='0.10';calculate()">$0.10</button>
              <button class="preset-btn" onclick="document.getElementById('elecCost').value='0.12';calculate()">$0.12</button>
              <button class="preset-btn" onclick="document.getElementById('elecCost').value='0.15';calculate()">$0.15</button>
            </div>
          </div>

          <div class="input-group">
            <label>Pool Fee</label>
            <div class="input-row">
              <input type="number" id="poolFee" value="2" min="0" max="10" step="0.5">
              <span class="input-unit">%</span>
            </div>
          </div>

          <button class="calc-btn" onclick="calculate()">‚õèÔ∏è Calculate Profitability</button>

          <div class="live-data" id="liveData">
            <div class="live-data-title">Live Network Data</div>
            <div class="live-row"><span class="live-label">BTC Price</span><span class="live-val" id="livePrice">--</span></div>
            <div class="live-row"><span class="live-label">Network Hashrate</span><span class="live-val" id="liveHash">--</span></div>
            <div class="live-row"><span class="live-label">Difficulty</span><span class="live-val" id="liveDiff">--</span></div>
            <div class="live-row"><span class="live-label">Block Reward</span><span class="live-val" id="liveReward">3.125 BTC</span></div>
            <div class="live-row"><span class="live-label">Next Adjustment</span><span class="live-val" id="liveNextAdj">--</span></div>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div class="calc-results">
        <div class="results-grid" id="resultsGrid">
          <div class="result-card hero">
            <div class="period">Daily</div>
            <div class="btc-amount" id="dailyBtc">--</div>
            <div class="fiat-amount" id="dailyFiat">--</div>
            <div class="costs" id="dailyCost">Power: --</div>
            <div class="profit" id="dailyProfit">--</div>
          </div>
          <div class="result-card">
            <div class="period">Monthly</div>
            <div class="btc-amount" id="monthlyBtc">--</div>
            <div class="fiat-amount" id="monthlyFiat">--</div>
            <div class="costs" id="monthlyCost">Power: --</div>
            <div class="profit" id="monthlyProfit">--</div>
          </div>
          <div class="result-card">
            <div class="period">Yearly</div>
            <div class="btc-amount" id="yearlyBtc">--</div>
            <div class="fiat-amount" id="yearlyFiat">--</div>
            <div class="costs" id="yearlyCost">Power: --</div>
            <div class="profit" id="yearlyProfit">--</div>
          </div>
        </div>

        <!-- Difficulty Scenarios -->
        <div class="scenarios">
          <div class="card">
            <div class="card-header">
              <h3>üìä Difficulty Adjustment Scenarios</h3>
            </div>
            <p style="color:var(--text-muted);font-size:13px;margin-bottom:16px;">How your profitability changes with different difficulty adjustments</p>
            <table class="scenario-table" id="scenarioTable">
              <thead>
                <tr>
                  <th>Scenario</th>
                  <th>Difficulty Change</th>
                  <th>Daily BTC</th>
                  <th>Daily Revenue</th>
                  <th>Daily Profit</th>
                  <th>Monthly Profit</th>
                </tr>
              </thead>
              <tbody id="scenarioBody"></tbody>
            </table>
          </div>
        </div>

        <p class="disclaimer">‚ö†Ô∏è Estimates only. Actual results depend on pool luck, transaction fees, network conditions, and BTC price volatility. Not financial advice.</p>
      </div>
    </div>

    <footer class="footer">
      <span>‚Çø difficultyadjustment.com ‚Ä¢ Mining profitability estimates ‚Ä¢ Data: mempool.space, CoinGecko</span>
    </footer>
  </div>

  <script>
    var btcPrice = 0;
    var networkHash = 0; // H/s
    var currentDifficulty = 0;
    var blockReward = 3.125;
    var projectedChange = 0;

    async function loadLiveData() {
      try {
        // Get mining data
        var mResp = await fetch('/api/mining');
        var mining = await mResp.json();
        if (mining.hashrate) {
          networkHash = mining.hashrate * 1e18; // convert EH/s to H/s
          document.getElementById('liveHash').textContent = mining.hashrate.toFixed(1) + ' EH/s';
        }
        if (mining.difficulty) {
          currentDifficulty = mining.difficulty * 1e12; // convert T to raw
          document.getElementById('liveDiff').textContent = mining.difficulty.toFixed(2) + ' T';
        }
        if (mining.adjustment) {
          projectedChange = mining.adjustment.difficultyChange;
          document.getElementById('liveNextAdj').textContent =
            (projectedChange >= 0 ? '+' : '') + projectedChange.toFixed(1) + '%';
        }
      } catch(e) {}

      try {
        // Get BTC price
        var pResp = await fetch('/api/prices');
        var prices = await pResp.json();
        if (Array.isArray(prices)) {
          var btc = prices.find(function(c) { return c.id === 'bitcoin'; });
          if (btc) {
            btcPrice = btc.current_price;
            document.getElementById('livePrice').textContent = '$' + btcPrice.toLocaleString();
          }
        }
      } catch(e) {}

      // Auto-calculate
      calculate();
    }

    function setPreset(hash, unit, watts, name) {
      document.getElementById('hashrate').value = hash;
      document.getElementById('hashUnit').value = unit;
      document.getElementById('power').value = watts;
      calculate();
    }

    function calculate() {
      var hashrate = parseFloat(document.getElementById('hashrate').value) || 0;
      var hashUnit = parseFloat(document.getElementById('hashUnit').value) || 1e12;
      var power = parseFloat(document.getElementById('power').value) || 0;
      var elecCost = parseFloat(document.getElementById('elecCost').value) || 0;
      var poolFee = parseFloat(document.getElementById('poolFee').value) || 0;

      var totalHash = hashrate * hashUnit; // H/s

      if (!currentDifficulty || !btcPrice || !totalHash) return;

      // BTC mined per day: (hashrate * 86400 * blockReward) / (difficulty * 2^32)
      var btcPerDay = (totalHash * 86400 * blockReward) / (currentDifficulty * Math.pow(2, 32));
      btcPerDay = btcPerDay * (1 - poolFee / 100); // subtract pool fee

      var dailyPowerCost = (power / 1000) * 24 * elecCost;
      var dailyRevenue = btcPerDay * btcPrice;
      var dailyProfit = dailyRevenue - dailyPowerCost;

      // Update display
      setResult('daily', btcPerDay, dailyRevenue, dailyPowerCost, dailyProfit);
      setResult('monthly', btcPerDay * 30, dailyRevenue * 30, dailyPowerCost * 30, dailyProfit * 30);
      setResult('yearly', btcPerDay * 365, dailyRevenue * 365, dailyPowerCost * 365, dailyProfit * 365);

      // Scenarios
      renderScenarios(totalHash, power, elecCost, poolFee);
    }

    function setResult(period, btc, revenue, cost, profit) {
      document.getElementById(period + 'Btc').textContent = btc.toFixed(8) + ' BTC';
      document.getElementById(period + 'Fiat').textContent = '$' + revenue.toLocaleString(undefined, {maximumFractionDigits: 2});
      document.getElementById(period + 'Cost').textContent = 'Power: $' + cost.toFixed(2);
      var profitEl = document.getElementById(period + 'Profit');
      profitEl.textContent = (profit >= 0 ? '+' : '') + '$' + profit.toLocaleString(undefined, {maximumFractionDigits: 2});
      profitEl.className = 'profit ' + (profit >= 0 ? 'positive' : 'negative');
    }

    function renderScenarios(totalHash, power, elecCost, poolFee) {
      var scenarios = [
        { name: 'Current', change: 0 },
        { name: 'Projected Next', change: projectedChange },
        { name: 'Moderate ‚Üë', change: 5 },
        { name: 'Large ‚Üë', change: 15 },
        { name: 'Massive ‚Üë', change: 30 },
        { name: 'Moderate ‚Üì', change: -5 },
        { name: 'Large ‚Üì', change: -15 },
        { name: 'Crash ‚Üì', change: -30 },
      ];

      var dailyPowerCost = (power / 1000) * 24 * elecCost;

      document.getElementById('scenarioBody').innerHTML = scenarios.map(function(s) {
        var adjDiff = currentDifficulty * (1 + s.change / 100);
        var btcPerDay = (totalHash * 86400 * blockReward) / (adjDiff * Math.pow(2, 32));
        btcPerDay = btcPerDay * (1 - poolFee / 100);
        var dailyRevenue = btcPerDay * btcPrice;
        var dailyProfit = dailyRevenue - dailyPowerCost;
        var monthlyProfit = dailyProfit * 30;
        var profitCls = dailyProfit >= 0 ? 'positive' : 'negative';

        return '<tr>' +
          '<td style="font-family:Inter,sans-serif;font-weight:600">' + s.name + '</td>' +
          '<td class="' + (s.change >= 0 ? 'negative' : 'positive') + '">' + (s.change >= 0 ? '+' : '') + s.change.toFixed(1) + '%</td>' +
          '<td>' + btcPerDay.toFixed(8) + '</td>' +
          '<td>$' + dailyRevenue.toFixed(2) + '</td>' +
          '<td class="' + profitCls + '">' + (dailyProfit >= 0 ? '+' : '') + '$' + dailyProfit.toFixed(2) + '</td>' +
          '<td class="' + profitCls + '">' + (monthlyProfit >= 0 ? '+' : '') + '$' + monthlyProfit.toFixed(0) + '</td>' +
        '</tr>';
      }).join('');
    }

    // Auto-calculate on any input change
    document.querySelectorAll('input, select').forEach(function(el) {
      el.addEventListener('input', calculate);
      el.addEventListener('change', calculate);
    });

    loadLiveData();
  </script>
</body>
</html>
